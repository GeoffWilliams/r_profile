<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Puppet Class: r_profile::linux::password_policy
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_classes::r_profile::linux::password_policy";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (r)</a> &raquo;
    <span class='title'><span class='object_link'>Puppet Classes</span></span>
     &raquo; 
    <span class="title">r_profile::linux::password_policy</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Puppet Class: r_profile::linux::password_policy</h1>
<div class="box_info">
  
  
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/linux/password_policy.pp
    </dd>
  </dl>
</div>

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<p>R_profile::Linux::Password_policy</p>

<p>Enforce aging settings: * password max days * password warn age</p>

<p>Enforce password quality:  * <code>/etc/security/pwquality.conf</code></p>

<p>Pam:  * Tell pam to remember old passwords to prevent reuse  * Tell pam to
enforce password quality</p>

<p>Requires:  * herculesteam-augeasproviders_pam  * puppetlabs-stdlib</p>

<p>The key names map to the available directives in the file. In this case,
password must:  * be 10 characters or more  * contain provide at least 1
digit  * contain at least one uppercase character  * contain at least one
special character  * contain at least one lowercase character</p>

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Hiera data for password quality</p>
</div></p>
      
      <pre class="example code"><code>r_profile::linux::password_policy::password_quality:
  minlen: 10
  dcredit: -1
  ucredit: -1
  ocredit: -1
  lcredit: -1</code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pass_max_days</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;90&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>maximum age of a password</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pass_warn_age</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;7&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>how long to warn before password expires</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password_algorithm</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;sha512&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>password algorithm to use</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>saved_passwords</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;4&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>how many old passwords to remember?</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>manage_authconfig</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>True to install <code>authconfig</code>, otherwise assume its already on
the system. <code>authconfig</code> command is required inspect the
password settings that apply on this system</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>$password_quality</span>
      
      
        <span class='type'></span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Hash of settings to enforce in /etc/security/pwquality.conf</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password_quality</span>
      
      
        <span class='type'>(<tt>Hash[String,Integer]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>


</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/linux/password_policy.pp', line 42</span>

class r_profile::linux::password_policy(
    String                $pass_max_days      = &quot;90&quot;,
    String                $pass_warn_age      = &quot;7&quot;,
    String                $password_algorithm = &quot;sha512&quot;,
    String                $saved_passwords    = &quot;4&quot;,
    Boolean               $manage_authconfig  = true,
    Hash[String,Integer]  $password_quality   = {}
) {

  if $manage_authconfig {
    package { &quot;authconfig&quot;:
      ensure =&gt; present,
    }
  }

  file_line { &quot;/etc/login.defs PASS_MAX_DAYS&quot;:
    ensure =&gt; present,
    path   =&gt; &quot;/etc/login.defs&quot;,
    match  =&gt; &quot;^PASS_MAX_DAYS&quot;,
    line   =&gt; &quot;PASS_MAX_DAYS ${pass_max_days}&quot;,
  }

  file_line { &quot;/etc/login.defs PASS_WARN_AGE&quot;:
    ensure =&gt; present,
    path   =&gt; &quot;/etc/login.defs&quot;,
    match  =&gt; &quot;^PASS_WARN_AGE&quot;,
    line   =&gt; &quot;PASS_WARN_AGE 90&quot;,
  }

  exec { &quot;authconfig password algorithm&quot;:
    command =&gt; &quot;authconfig --passalgo=${password_algorithm} --update&quot;,
    unless  =&gt; &quot;authconfig --test | awk &#39;/hashing/ {print \$5}&#39; | grep ${password_algorithm}&quot;,
    path    =&gt; [&quot;/usr/bin&quot;, &quot;/usr/sbin&quot;, &quot;/bin&quot;, &quot;/sbin&quot;],
  }

  # how many old passwords to remember?
  #
  # Note:  The vagrant box used for testing had duplicate entries in
  # /etc/pam.d/system-auth that were enough to break idempotency:
  #  password    sufficient    pam_unix.so
  #  password     sufficient   pam_unix.so
  # Note &#39;off&#39; spacing which suggests added by a build script...  This suggests
  # that such entries are not normally present.  To resolve the condition, the
  # duplicate entry was manually removed and the resource was then processed
  # idempotently.
  pam { &quot;system-auth password sufficient pam_unix.so remember&quot;:
    ensure    =&gt; present,
    service   =&gt; &#39;system-auth&#39;,
    type      =&gt; &#39;password&#39;,
    control   =&gt; &#39;sufficient&#39;,
    module    =&gt; &#39;pam_unix.so&#39;,
    arguments =&gt; &quot;remember=${saved_passwords}&quot;,
    position  =&gt; &#39;before module pam_deny.so&#39;,
  }

  # Make sure pam password quality still enabled (the default)
  pam { &quot;system-auth password pam_pwquality&quot;:
    ensure    =&gt; present,
    service   =&gt; &#39;system-auth&#39;,
    type      =&gt; &#39;password&#39;,
    control   =&gt; &#39;requisite&#39;,
    module    =&gt; &#39;pam_pwquality.so&#39;,
    arguments =&gt; [&quot;try_first_pass&quot;, &quot;local_users_only&quot;, &quot;retry=3&quot;, &quot;authtok_type=&quot;],
    position  =&gt; &#39;before *[type=&quot;password&quot; and module=&quot;pam_unix.so&quot;]&#39;,
  }


  # su access for members of wheel (uncomment existing rule in stock file), needs
  # different position for rhel 7 vs 6
  if $facts[&#39;os&#39;][&#39;release&#39;][&#39;major&#39;] == &quot;7&quot; {
    $condition = &#39;before *[type=&quot;auth&quot; and control=&quot;substack&quot;]&#39;
  } else {
    $condition = &#39;before *[type=&quot;auth&quot; and control=&quot;include&quot;]&#39;
  }
  pam { &quot;su auth required pam_wheel.so use_uid&quot;:
    ensure    =&gt; present,
    service   =&gt; &#39;su&#39;,
    type      =&gt; &#39;auth&#39;,
    control   =&gt; &#39;required&#39;,
    module    =&gt; &#39;pam_wheel.so&#39;,
    arguments =&gt; &#39;use_uid&#39;,
    position  =&gt; $condition,
  }

  $password_quality.each |$key,$value| {
    file_line { &quot;/etc/security/pwquality.conf ${key}&quot;:
      ensure =&gt; present,
      path   =&gt; &quot;/etc/security/pwquality.conf&quot;,
      match  =&gt; &quot;^${key}&quot;,
      line   =&gt; &quot;${key}=${value}&quot;,
    }
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>